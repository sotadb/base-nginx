{
	consul: "localhost:8500",
	jobs: [
		{
			name: "consul-agent",
			exec: ["consul", "agent", "-config-dir=/etc/consul"],
			health: { exec: "consul info | awk 'BEGIN {rv=1}; (2 < $3)&&(/known_servers/) {rv=0}; END{exit rv}'", interval: 5, ttl: 5, timeout: "4s" },
			restarts: "unlimited"
		},
		{
			name: "nginx-setup",
			exec: ["/usr/bin/consul-template", "-once", "-template", "/etc/nginx/nginx.hcl:/etc/nginx/nginx.conf" ],
			when: { source: "consul-agent", once: "healthy" }
		},
		{
			name: "nginx",
			port: 80,
			exec: ["/usr/sbin/nginx"],
			when: { source: "nginx-setup", once: "exitSuccess" },
			health: { exec: ["/usr/bin/curl", "--fail", "-o", "/dev/null", "http://localhost/nginx-health"], interval: 5, ttl: 5, timeout: "4s" }
		},
		{
			name: "onChange-consul",
			exec: ["/usr/bin/consul-template", "-once", "-template", "/etc/nginx/nginx.hcl:/etc/nginx/nginx.conf"],
			when: { source: "watch.consul", each: "changed" }
		},
		{
			name: "preStop",
			exec: ["consul", "leave"],
			when: { source: "consul", once: "stopping" }
		}
	],
	watches: [
		{ name: "consul", interval: 3 }
	]
}
