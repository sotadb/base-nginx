{
	consul: "localhost:8500",
	jobs: [
		{
			name: "consul-agent",
			exec: ["consul", "agent", "-ui", "-config-dir=/etc/consul"],
			health: {exec: "consul-check", interval: 5, ttl: 5, timeout: "4s"},
			restarts: "unlimited"
		},
		{
			name: "preStop",
			exec: ["consul", "leave"],
			when: { source: "consul-agent", once: "stopping" }
		},
		{
			name: "dhparam-init",
			when: { source: "consul-agent", once: "healthy" },
			exec: ["consul", "lock", "nginx/dhparams", "dhparam-init"]
		},
		{	name: "domains-init",
			when: { source: "dhparam-init", once: "exitSuccess" },
			exec: ["update-domains"]
		},
		{
			name: "nginx",
			port: 80,
			exec: ["/usr/bin/consul-template", "-exec", "/usr/sbin/nginx", "-template", "/etc/nginx/nginx.hcl:/etc/nginx/nginx.conf" ],
			when: { source: "domains-init", once: "exitSuccess" },
			health: { exec: ["/usr/bin/nginx-manage", "http-check"], interval: 5, ttl: 10, timeout: "4s" }
		},
		{
			name: "nginx-ssl",
			port: 443,
			when: { source: "nginx", once: "healthy" },
			health: { exec: ["/usr/bin/nginx-manage", "https-check"], interval: 5, ttl: 10, timeout: "4s" }
		},
		{
			name: "acme-challange",
			exec: ["/usr/bin/acme-manage", "watch-challange"],
			when: { source: "consul-agent", once: "healthy" },
			restarts: "unlimited"
		},
		{
			name: "onChange-Domains",
			exec: ["consul", "watch", "-type=key", "-key=nginx/DOMAIN_NAMES", "update-domains"],
			when: { source: "consul-agent", once: "healthy" },
			restarts: "unlimited"
		},
		{
			name: "onChange-challange",
			exec: ["consul", "watch", "-type=key", "-key=nginx/acme/challange-name", "acme-manage", "get-challange"]
			when: { source: "consul-agent", once: "healthy" }
			restarts: "unlimited"
		},
		{
			name: "acme",
			exec: ["/usr/bin/acme-manage", "client"], 
			when: { source: "nginx", once: "healthy" },
			restarts: "unlimited"
		}
	]
}
